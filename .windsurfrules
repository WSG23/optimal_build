# Optimal Build - AI Coding Rules
# Auto-loaded by Cursor/Windsurf. Rules are EMBEDDED here - no need to read other files to start.

## STOP BEFORE CODING - Check These First

| Question | Where to Check |
|----------|----------------|
| What should I build? | `docs/ai-agents/next_steps.md` |
| What's already done? | `docs/all_steps_to_product_completion.md` |
| Detailed coding rules? | `CODING_RULES.md` |

---

## 5 CRITICAL RULES (Violating these breaks the build)

### 1. Database Migrations - NEVER EDIT EXISTING FILES
```bash
# CORRECT - Create new migration
cd backend && alembic revision -m "add_column"

# WRONG - Never edit files in backend/migrations/versions/
```
- Use `sa.String()` for ENUM columns, NOT `sa.Enum()`
- Match Python enum VALUES exactly in SQL

### 2. Async/Await - ALL Database Operations
```python
# CORRECT
async def get_property(db: AsyncSession, id: int):
    result = await db.execute(select(Property).where(Property.id == id))
    return result.scalar_one_or_none()

# WRONG - Missing async/await
def get_property(db: Session, id: int):
    return db.query(Property).filter(Property.id == id).first()
```

### 3. Before Committing - MUST PASS
```bash
make format   # Auto-fix formatting
make verify   # Run all checks - MUST PASS before commit
```

### 4. Frontend UI - Use Design Tokens
```tsx
// CORRECT - Use tokens
<Box sx={{ p: 'var(--ob-space-100)', borderRadius: 'var(--ob-radius-sm)' }}>

// WRONG - Hardcoded values
<Box sx={{ p: '16px', borderRadius: '12px' }}>
```
- Cards: `--ob-radius-sm` (4px)
- Buttons: `--ob-radius-xs` (2px)
- Modals: `--ob-radius-lg` (8px)
- See `frontend/UI_STANDARDS.md` for all tokens

### 5. Testing - Always Provide Commands
After completing ANY feature, tell user:
```bash
# Backend tests
pytest backend/tests/test_api/test_[feature].py -v

# Frontend (if applicable)
cd frontend && npm run lint
```

---

## Project Structure

```
backend/
  app/api/v1/        # FastAPI endpoints (async def)
  app/models/        # SQLAlchemy models
  app/services/      # Business logic
  migrations/        # Alembic (NEVER EDIT EXISTING)

frontend/
  src/components/canonical/  # USE THESE reusable components
  src/app/pages/             # Page components
  UI_STANDARDS.md            # Design token values

docs/
  ai-agents/next_steps.md              # WHAT TO BUILD
  all_steps_to_product_completion.md   # PROJECT STATUS
```

---

## Quick Decisions

| Situation | Action |
|-----------|--------|
| Need to add DB column | Create NEW migration, never edit existing |
| Writing API endpoint | Use `async def`, require auth with `Depends(get_current_user)` |
| Frontend styling | Use `var(--ob-*)` tokens, never hardcode px/colors |
| Unsure what to build | Read `docs/ai-agents/next_steps.md` first |
| Tests failing | Check `docs/all_steps_to_product_completion.md#-known-testing-issues` |
| Large change (>5 files) | Ask user for approval first |

---

## For Detailed Reference

- Full coding rules: `CODING_RULES.md`
- UI token values: `frontend/UI_STANDARDS.md`
- Layout patterns: `frontend/UX_ARCHITECTURE.md`
- Claude-specific: `CLAUDE.md`
