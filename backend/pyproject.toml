[tool.black]
line-length = 88
target-version = ["py311"]
include = "\\.pyi?$"
exclude = """
/(
  \\.git
 | \\.venv
 | build
 | dist
)/
"""

[tool.isort]
profile = "black"
line_length = 88
combine_as_imports = true
known_first_party = ["app", "flows", "jobs", "scripts"]
known_third_party = ["backend"]
sections = ["FUTURE", "STDLIB", "THIRDPARTY", "FIRSTPARTY", "LOCALFOLDER"]
# Skip migration files - they follow Alembic conventions
extend_skip_glob = ["*/migrations/versions/*.py"]

[tool.ruff]
line-length = 100
target-version = "py311"
src = ["backend", "app", "flows", "jobs", "scripts"]
exclude = [
    ".venv",
    ".git",
    "build",
    "dist",
    "frontend",
    "ui-admin",
    "_vendor",
    "migrations",
    "starlette",
    "aiosqlite",
]

[tool.ruff.lint]
select = ["E", "F", "W"]
extend-select = ["B"]
ignore = ["E203", "E402", "E501"]  # handled by black
extend-ignore = ["B008"]

[tool.ruff.lint.isort]
known-first-party = ["app", "flows", "jobs", "scripts"]
known-third-party = ["backend"]
section-order = ["future", "standard-library", "third-party", "first-party", "local-folder"]

[tool.mypy]
python_version = "3.11"
plugins = ["sqlalchemy.ext.mypy.plugin"]
warn_unused_configs = true
disallow_untyped_defs = true
disallow_incomplete_defs = true
check_untyped_defs = true
ignore_missing_imports = true
no_implicit_optional = true
strict_optional = true
explicit_package_bases = true
exclude = "frontend|ui-admin|tests|(^|/)fastapi/|(^|/)httpx/|(^|/)sqlalchemy/|(^|/)uvicorn_app/|(^|/)backend/sqlalchemy_pkg_backup/|(^|/)backend/_vendor/|(^|/)backend/(fastapi_shadow_|starlette_shadow_).*|(^|/)backend/migrations/"

[[tool.mypy.overrides]]
module = [
    "fastapi",
    "fastapi.*",
    "starlette",
    "starlette.*",
    "sqlalchemy",
    "sqlalchemy.*",
    "uvicorn_app",
    "uvicorn_app.*",
    "httpx",
    "httpx.*",
    "backend.sqlalchemy_pkg_backup",
    "backend.sqlalchemy_pkg_backup.*",
    "backend._vendor",
    "backend._vendor.*",
    "backend.migrations",
    "backend.migrations.*",
]
ignore_errors = true

[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]
addopts = "-v -p pytest_cov"
asyncio_mode = "auto"
filterwarnings = [
    "ignore:.*`example` has been deprecated, please use `examples` instead:DeprecationWarning",
    "ignore:'crypt' is deprecated and slated for removal in Python 3.13:DeprecationWarning",
    "ignore:Support for class-based `config` is deprecated:DeprecationWarning",
    "ignore:The ``declarative_base\\(\\)`` function is now available as sqlalchemy.orm.declarative_base:DeprecationWarning",
]
