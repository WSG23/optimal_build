# Declare per-rule exceptions for the coding rules checker.
# See CODING_RULES.md for guidance before adding entries.
exceptions:
  rule_1_migrations:
    # Pre-existing migrations with known issues - do not modify these
    - backend/migrations/versions/0773c87952ef_add_singapore_properties_table_with_mvp_.py
    - backend/migrations/versions/20241228_000006_add_commercial_property_agent_tables.py
    # Agent advisory feedback - uses if_exists=True guards in downgrade
    - backend/migrations/versions/20250220_000009_add_agent_advisory_feedback.py
    # Listing integration - uses if_exists=True guards in downgrade
    - backend/migrations/versions/20250220_000010_add_listing_integration_tables.py
    # Business performance tables - uses if_exists=True guards in downgrade
    - backend/migrations/versions/20250220_000011_add_business_performance_tables.py
    # Commission/performance/developer tables added in Phase 2A (uses if_exists guards)
    - backend/migrations/versions/20250220_000012_add_commission_tables.py
    - backend/migrations/versions/20250220_000013_add_performance_snapshots.py
    - backend/migrations/versions/20251013_000014_add_developer_due_diligence_checklists.py
    - backend/migrations/versions/20251013_000015_add_developer_condition_assessments.py
    # Foreign key indexes - uses inspector.get_indexes() guard in downgrade
    - backend/migrations/versions/20251028_000020_add_foreign_key_indexes.py
    # Jurisdiction code column - simple drop operations without guards (acceptable for single column)
    - backend/migrations/versions/20251118_000025_add_property_jurisdiction.py
    # Property-Project link - standard downgrade with drop operations (project_id, owner_email columns)
    - backend/migrations/versions/20251230_000039_add_property_project_link.py
    # Regstack migrations - different schema
    - db/versions/20250216000000_init_regstack.py
    - db/versions/20250217000100_add_provenance_checksum.py
  rule_2_async:
    # ✅ PARTIALLY RESOLVED 2025-11-23: singapore_property_api.py converted to async
    # ⚠️ PENDING: users_db.py and projects_api.py still use sync patterns (low priority)
    - backend/app/api/v1/users_db.py
    - backend/app/api/v1/projects_api.py
    # - backend/app/api/v1/singapore_property_api.py - ✅ CONVERTED (764 lines)
    #
    # All 9 routes in singapore_property_api.py converted to async:
    # ✅ create_property (line 213) - async with update_property_compliance()
    # ✅ list_properties (line 277) - async with select() + filters
    # ✅ get_property (line 312) - async with select() + scalar_one_or_none()
    # ✅ update_property (line 337) - async with update_property_compliance()
    # ✅ check_property_compliance (line 379) - async with run_full_compliance_check()
    # ✅ calculate_property_gfa (line 421) - async with select()
    # ✅ calculate_buildable_metrics (line 459) - already async
    # ✅ check_compliance (line 628) - already async
    # ✅ delete_property (line 737) - async with select() + delete()
    #
    # Changes made:
    # - Removed get_sync_db() and sync engine setup
    # - Replaced Session with AsyncSession dependency (get_session)
    # - Converted .query() to select() statements with await db.execute()
    # - Added await to db.commit(), db.refresh(), db.delete()
    # - Replaced update_property_compliance_sync() with async update_property_compliance()
    # - Replaced run_full_compliance_check_sync() with async run_full_compliance_check()
    #
    # Testing: All unit tests passing (19 passed, 1 skipped)
  # rule_4_dependency_pinning:
    # RESOLVED 2025-11-21: All 7 dependencies now pinned with ==
    # asyncpg==0.30.0, shapely==2.0.6, pandas==2.2.3, numpy==1.26.4,
    # statsmodels==0.14.1, scikit-learn==1.5.0, reportlab==4.0.8
  rule_5_singapore:
    # Test failures due to DB setup issues, not compliance violations
    - backend/app/models/singapore_property.py
  rule_1_2_enum_pattern:
    # Pre-existing migrations with sa.Enum(..., create_type=False) pattern
    # These were created before CODING_RULES.md Section 1.2 was enforced
    # Do NOT add new migrations here - fix the pattern instead!
    - backend/migrations/versions/0773c87952ef_add_singapore_properties_table_with_mvp_.py
    - backend/migrations/versions/20240816_000004_add_entitlements_tables.py
    - backend/migrations/versions/20241228_000006_add_commercial_property_agent_tables.py
    - backend/migrations/versions/20250220_000010_add_listing_integration_tables.py
    - backend/migrations/versions/20250220_000011_add_business_performance_tables.py
    - backend/migrations/versions/20250220_000012_add_commission_tables.py
    - backend/migrations/versions/20251013_000014_add_developer_due_diligence_checklists.py
    - backend/migrations/versions/20251022_000017_add_preview_jobs.py
    - backend/migrations/versions/20251026_000019_add_projects_table_columns.py
    - backend/migrations/versions/4c8849dec050_add_asset_type_to_agent_deals_manual.py

  rule_7_code_quality:
    # RESOLVED 2025-11-21: Added isort: skip comments to resolve import ordering
    # backend._compat imports now properly annotated
    # Long URL in documentation string
    - scripts/smoke_test_pdfs.py
